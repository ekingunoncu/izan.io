{
  "id": "flights-scrape-details",
  "name": "flights_scrape_details",
  "description": "Scrape detailed flight information from a Google Flights result URL. Returns full itinerary details including layovers, aircraft type, baggage info, and booking options.",
  "version": "1.0.0",
  "parameters": [
    {
      "name": "flight_url",
      "type": "string",
      "description": "Google Flights URL for a specific flight result (from flights_search results)",
      "required": true
    }
  ],
  "steps": [
    {
      "action": "navigate",
      "url": "{{flight_url}}",
      "label": "Open flight details page"
    },
    {
      "action": "waitForSelector",
      "selector": "div.yR1fYc, div.BVAVmf, li.pIav2d",
      "timeout": 20000,
      "label": "Wait for flight details"
    },
    {
      "action": "wait",
      "ms": 3000,
      "label": "Let details fully render"
    },
    {
      "action": "code",
      "code": "const expandBtns = document.querySelectorAll('button[aria-expanded=\"false\"], div[role=\"button\"][aria-expanded=\"false\"]'); expandBtns.forEach(btn => { const label = (btn.getAttribute('aria-label') || btn.textContent || '').toLowerCase(); if (label.includes('flight') || label.includes('detail') || label.includes('more') || label.includes('expand')) btn.click(); }); return { expanded: expandBtns.length }",
      "name": "expand_details",
      "label": "Expand flight detail sections"
    },
    {
      "action": "wait",
      "ms": 2000,
      "label": "Wait for expanded content"
    },
    {
      "action": "scroll",
      "direction": "down",
      "amount": 800,
      "label": "Scroll to see more details"
    },
    {
      "action": "wait",
      "ms": 1500
    },
    {
      "action": "code",
      "code": "const segments = []; const segmentEls = document.querySelectorAll('div.yR1fYc, div.BVAVmf'); segmentEls.forEach((seg, i) => { if (i >= 6) return; const airlineEl = seg.querySelector('div.sSHqwe.tPgKwe.ogfYpf, div.sSHqwe span'); const flightNumEl = seg.querySelector('span.Xsgmwe'); const aircraftEl = seg.querySelector('span[class*=\"aircraft\"]'); const depTimeEl = seg.querySelector('span[aria-label^=\"Departure time\"], div.zxVSec span.eoY5cb'); const arrTimeEl = seg.querySelector('span[aria-label^=\"Arrival time\"]'); const depAirportEl = seg.querySelector('div.G2WY5c span'); const arrAirportEl = seg.querySelector('div.c8rWCd span'); const durationEl = seg.querySelector('div[aria-label^=\"Total duration\"], div.gvkrdb'); const classEl = seg.querySelector('span[class*=\"cabin\"]'); segments.push({ airline: airlineEl ? airlineEl.textContent.trim() : '', flight_number: flightNumEl ? flightNumEl.textContent.trim() : '', aircraft: aircraftEl ? aircraftEl.textContent.trim() : '', departure_time: depTimeEl ? depTimeEl.textContent.trim() : '', arrival_time: arrTimeEl ? arrTimeEl.textContent.trim() : '', departure_airport: depAirportEl ? depAirportEl.textContent.trim() : '', arrival_airport: arrAirportEl ? arrAirportEl.textContent.trim() : '', duration: durationEl ? durationEl.textContent.trim() : '', cabin_class: classEl ? classEl.textContent.trim() : '' }); }); const priceEl = document.querySelector('div.FpEdX span, div.YMlIz span, span[data-gs]'); const totalDurationEl = document.querySelector('div[aria-label^=\"Total duration\"], div.gvkrdb'); const co2El = document.querySelector('div.O7CXue, div[class*=\"emission\"]'); const layoverEls = document.querySelectorAll('div.tvtJdb, div[class*=\"layover\"]'); const layovers = []; layoverEls.forEach(l => { layovers.push(l.textContent.trim()); }); const baggageEl = document.querySelector('div.YBQ0ob, div[class*=\"baggage\"], span[aria-label*=\"bag\"]'); return { price: priceEl ? priceEl.textContent.trim() : '', total_duration: totalDurationEl ? totalDurationEl.textContent.trim() : '', segments: segments, layovers: layovers, co2_emissions: co2El ? co2El.textContent.trim() : '', baggage: baggageEl ? baggageEl.textContent.trim() : '', url: window.location.href }",
      "name": "flight_details",
      "label": "Extract detailed flight information"
    }
  ]
}