{
  "id": "telegram-send-message",
  "name": "telegram_send_message",
  "description": "Send a message in a Telegram chat. Searches for the chat by name, opens it, types the message, and sends it. You must be logged in to Telegram Web.",
  "version": "1.0.0",
  "parameters": [
    {
      "name": "chat_name",
      "type": "string",
      "description": "Name of the chat, group, or channel to send the message to",
      "required": true
    },
    {
      "name": "message",
      "type": "string",
      "description": "Message text to send",
      "required": true
    }
  ],
  "steps": [
    {
      "action": "navigate",
      "url": "https://web.telegram.org/k/",
      "label": "Open Telegram Web"
    },
    {
      "action": "waitForSelector",
      "selector": ".input-search input, .chatlist-chat, .chat-list",
      "timeout": 15000,
      "label": "Wait for Telegram to load"
    },
    {
      "action": "wait",
      "ms": 2000,
      "label": "Let app fully initialize"
    },
    {
      "action": "code",
      "code": "const searchInput = document.querySelector('.input-search input') || document.querySelector('input[type=\"text\"]'); if (searchInput) { searchInput.focus(); searchInput.click(); await new Promise(r => setTimeout(r, 300)); searchInput.value = ''; searchInput.dispatchEvent(new Event('input', { bubbles: true })); document.execCommand('insertText', false, `{{chat_name}}`); searchInput.dispatchEvent(new Event('input', { bubbles: true })); } return { searched: true }",
      "name": "search_chat",
      "label": "Search for the chat"
    },
    {
      "action": "wait",
      "ms": 2500,
      "label": "Wait for search results"
    },
    {
      "action": "code",
      "code": "const chatItems = document.querySelectorAll('.chatlist-chat, .chat-list .ListItem, .search-group .chatlist-chat'); let clicked = false; for (const item of chatItems) { const nameEl = item.querySelector('.peer-title, .user-title, .dialog-title'); if (nameEl && nameEl.textContent.trim().toLowerCase().includes(`{{chat_name}}`.toLowerCase())) { item.click(); clicked = true; break; } } if (!clicked && chatItems.length > 0) { chatItems[0].click(); clicked = true; } return { clicked: clicked }",
      "name": "click_chat",
      "label": "Click on the matching chat"
    },
    {
      "action": "wait",
      "ms": 2000,
      "label": "Wait for chat to open"
    },
    {
      "action": "waitForSelector",
      "selector": "[contenteditable='true'].input-message-input, .input-message-input",
      "timeout": 10000,
      "label": "Wait for message input"
    },
    {
      "action": "code",
      "code": "const el = document.querySelector('.input-message-input[contenteditable=\"true\"]') || document.querySelector('[contenteditable=\"true\"].input-message-input'); if (!el) throw new Error('Message input not found'); el.focus(); await new Promise(r => setTimeout(r, 300)); document.execCommand('insertText', false, `{{message}}`); el.dispatchEvent(new Event('input', { bubbles: true })); return { typed: true }",
      "name": "type_message",
      "label": "Type message"
    },
    {
      "action": "wait",
      "ms": 500
    },
    {
      "action": "code",
      "code": "const sendBtn = document.querySelector('.btn-send, .send-btn, button.btn-icon.send'); if (sendBtn) { sendBtn.click(); } else { const el = document.querySelector('.input-message-input[contenteditable=\"true\"]') || document.querySelector('[contenteditable=\"true\"].input-message-input'); if (el) { el.dispatchEvent(new KeyboardEvent('keydown', { key: 'Enter', code: 'Enter', keyCode: 13, which: 13, bubbles: true })); } } return { success: true, message: 'Message sent' }",
      "name": "result",
      "label": "Send message"
    },
    {
      "action": "wait",
      "ms": 1500
    }
  ]
}