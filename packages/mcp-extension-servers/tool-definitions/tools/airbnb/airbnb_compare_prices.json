{
  "id": "airbnb-compare-prices",
  "name": "airbnb_compare_prices",
  "description": "Compare prices across similar Airbnb listings in a location. Searches listings and extracts price comparisons including nightly rate, total price, rating, and property type for easy comparison.",
  "version": "1.0.0",
  "parameters": [
    {
      "name": "location",
      "type": "string",
      "description": "Location to compare prices (e.g. 'Paris, France', 'Manhattan, New York')",
      "required": true
    }
  ],
  "steps": [
    {
      "action": "navigate",
      "url": "https://www.airbnb.com/s/{{location}}/homes",
      "label": "Search Airbnb listings"
    },
    {
      "action": "waitForSelector",
      "selector": "[itemprop='itemListElement'], [data-testid='card-container'], [data-testid='listing-card-title']",
      "timeout": 15000,
      "label": "Wait for search results"
    },
    {
      "action": "wait",
      "ms": 3000,
      "label": "Let results render"
    },
    {
      "action": "scroll",
      "direction": "down",
      "amount": 1200,
      "label": "Scroll to load more results"
    },
    {
      "action": "wait",
      "ms": 2000
    },
    {
      "action": "scroll",
      "direction": "down",
      "amount": 1200,
      "label": "Scroll further"
    },
    {
      "action": "wait",
      "ms": 2000
    },
    {
      "action": "scroll",
      "direction": "down",
      "amount": 1200,
      "label": "Scroll for more listings"
    },
    {
      "action": "wait",
      "ms": 2000
    },
    {
      "action": "scroll",
      "direction": "down",
      "amount": 1200,
      "label": "Scroll to load all visible listings"
    },
    {
      "action": "wait",
      "ms": 2000
    },
    {
      "action": "code",
      "code": "const listings = []; const cards = document.querySelectorAll('[itemprop=\"itemListElement\"], [data-testid=\"card-container\"], [aria-labelledby]'); for (let i = 0; i < Math.min(cards.length, 20); i++) { const el = cards[i]; const titleEl = el.querySelector('[data-testid=\"listing-card-title\"], [id^=\"title_\"]'); const subtitleEl = el.querySelector('[data-testid=\"listing-card-subtitle\"]'); const priceEl = el.querySelector('[data-testid=\"price-availability-row\"] span span, span._tyxjp1, span._14y1168'); const totalPriceEl = el.querySelector('[data-testid=\"price-availability-row\"] span[class*=\"total\"], button[aria-label*=\"total\"], ._1jo4hgw span'); const ratingEl = el.querySelector('[aria-label*=\"rating\"], .t1a9j9y7 span, svg[aria-label*=\"Rating\"] + span'); const linkEl = el.querySelector('a[href*=\"/rooms/\"]'); const imgEl = el.querySelector('img[src*=\"images\"]'); const bedsEl = el.querySelector('[data-testid=\"listing-card-subtitle\"]:last-of-type'); const superhostEl = el.querySelector('[aria-label*=\"Superhost\"], [data-testid*=\"superhost\"]'); const url = linkEl ? (linkEl.href.startsWith('http') ? linkEl.href : 'https://www.airbnb.com' + linkEl.getAttribute('href')) : ''; const title = titleEl ? titleEl.textContent.trim() : ''; const priceText = priceEl ? priceEl.textContent.trim() : ''; if (title && priceText) { listings.push({ title: title, subtitle: subtitleEl ? subtitleEl.textContent.trim() : '', price_per_night: priceText, total_price: totalPriceEl ? totalPriceEl.textContent.trim() : '', rating: ratingEl ? ratingEl.textContent.trim() : '', property_details: bedsEl ? bedsEl.textContent.trim() : '', is_superhost: !!superhostEl, image: imgEl ? imgEl.getAttribute('src') : '', url: url }); } } listings.sort(function(a, b) { const priceA = parseFloat(a.price_per_night.replace(/[^0-9.]/g, '')) || 0; const priceB = parseFloat(b.price_per_night.replace(/[^0-9.]/g, '')) || 0; return priceA - priceB; }); const prices = listings.map(function(l) { return parseFloat(l.price_per_night.replace(/[^0-9.]/g, '')) || 0; }).filter(function(p) { return p > 0; }); const avgPrice = prices.length > 0 ? (prices.reduce(function(a, b) { return a + b; }, 0) / prices.length).toFixed(2) : '0'; const minPrice = prices.length > 0 ? Math.min.apply(null, prices) : 0; const maxPrice = prices.length > 0 ? Math.max.apply(null, prices) : 0; return { location: `{{location}}`, listing_count: listings.length, price_summary: { average_price_per_night: avgPrice, min_price_per_night: minPrice, max_price_per_night: maxPrice, currency: listings[0] ? listings[0].price_per_night.replace(/[0-9.,\\s]/g, '').trim() : '' }, listings: listings }",
      "name": "price_comparison",
      "label": "Extract and compare prices"
    }
  ]
}