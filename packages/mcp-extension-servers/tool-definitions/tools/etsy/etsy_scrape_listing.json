{
  "id": "etsy-scrape-listing",
  "name": "etsy_scrape_listing",
  "description": "Scrape full listing details from an Etsy product page. Returns title, price, rating, review count, description, images, shop name, shipping info, and item details.",
  "version": "1.0.0",
  "parameters": [
    {
      "name": "listing_url",
      "type": "string",
      "description": "Etsy listing URL (e.g. 'https://www.etsy.com/listing/1234567890/handmade-ring')",
      "required": true
    }
  ],
  "steps": [
    {
      "action": "navigate",
      "url": "{{listing_url}}",
      "label": "Open listing page"
    },
    {
      "action": "waitForSelector",
      "selector": "h1[data-buy-box-listing-title], h1, [data-listing-id]",
      "timeout": 15000,
      "label": "Wait for listing page to load"
    },
    {
      "action": "wait",
      "ms": 2000,
      "label": "Let page fully render"
    },
    {
      "action": "scroll",
      "direction": "down",
      "amount": 800,
      "label": "Scroll to load additional content"
    },
    {
      "action": "wait",
      "ms": 1500
    },
    {
      "action": "scroll",
      "direction": "down",
      "amount": 800,
      "label": "Scroll further down"
    },
    {
      "action": "wait",
      "ms": 1500
    },
    {
      "action": "code",
      "code": "const titleEl = document.querySelector('h1[data-buy-box-listing-title], h1'); const priceEl = document.querySelector('.wt-text-title-larger, [data-buy-box-listing-price] p, p.wt-text-title-03'); const ratingEl = document.querySelector('input[name=\"rating\"], [data-rating], [aria-label*=\"star\"]'); const reviewCountEl = document.querySelector('a[href*=\"reviews\"] span, a[href*=\"#reviews\"]'); const descriptionEl = document.querySelector('div[data-id=\"description-text\"], [data-product-details-description-text-content], p[data-product-details-description-text-content]'); const shopNameEl = document.querySelector('a[href*=\"/shop/\"].wt-text-link, a[href*=\"/shop/\"][aria-label], [data-shop-name]'); const shopLocationEl = document.querySelector('[data-shop-location], span[aria-label*=\"location\"]'); const images = []; const imageEls = document.querySelectorAll('ul[data-carousel-pagination] img, [data-carousel] img, img[src*=\"etsystatic.com/isc\"], img[src*=\"etsystatic.com/il\"]'); imageEls.forEach(function(img) { const src = img.getAttribute('src') || ''; if (src && src.includes('etsystatic') && !images.includes(src)) { images.push(src); } }); const shippingEl = document.querySelector('[data-estimated-delivery], [aria-label*=\"shipping\"], [aria-label*=\"delivery\"]'); const materialsEl = document.querySelector('#legacy-materials-product-details, [data-id=\"materials\"]'); const materials = materialsEl ? materialsEl.textContent.trim().split(',').map(function(m) { return m.trim(); }).filter(Boolean) : []; const detailRows = document.querySelectorAll('table tr, [data-product-details] tr'); const details = {}; detailRows.forEach(function(row) { const labelEl = row.querySelector('th, td:first-child'); const valueEl = row.querySelector('td:last-child, td:nth-child(2)'); if (labelEl && valueEl && labelEl !== valueEl) { details[labelEl.textContent.trim()] = valueEl.textContent.trim(); } }); const favoritesEl = document.querySelector('[data-favorite-listing] span, [aria-label*=\"favorite\"] span'); const variationEls = document.querySelectorAll('select[id*=\"variation\"] option, [data-selector-id] option, [aria-label*=\"variation\"] option'); const variations = []; variationEls.forEach(function(el) { const text = el.textContent.trim(); if (text && text !== 'Select an option' && text !== 'Please select an option') variations.push(text); }); var ldData = {}; try { var ldScript = document.querySelector('script[type=\"application/ld+json\"]'); if (ldScript) { ldData = JSON.parse(ldScript.textContent) || {}; } } catch(e) {} return { title: titleEl ? titleEl.textContent.trim() : (ldData.name || ''), price: priceEl ? priceEl.textContent.trim() : (ldData.offers && ldData.offers.price ? ldData.offers.priceCurrency + ldData.offers.price : ''), rating: ratingEl ? (ratingEl.getAttribute('value') || ratingEl.getAttribute('aria-label') || ratingEl.textContent.trim()) : '', review_count: reviewCountEl ? reviewCountEl.textContent.trim() : '', description: descriptionEl ? descriptionEl.textContent.trim().substring(0, 1500) : (ldData.description ? ldData.description.substring(0, 1500) : ''), shop_name: shopNameEl ? shopNameEl.textContent.trim() : '', shop_location: shopLocationEl ? shopLocationEl.textContent.trim() : '', shipping: shippingEl ? shippingEl.textContent.trim() : '', materials: materials.slice(0, 10), details: details, variations: variations.slice(0, 20), favorites: favoritesEl ? favoritesEl.textContent.trim() : '', images: images.slice(0, 8), url: window.location.href }",
      "name": "listing_data",
      "label": "Extract listing details"
    }
  ]
}
