{
  "id": "etsy-scrape-categories",
  "name": "etsy_scrape_categories",
  "description": "Browse and scrape Etsy category pages. Returns featured listings, subcategories, and trending items within a category.",
  "version": "1.0.0",
  "parameters": [
    {
      "name": "category",
      "type": "string",
      "description": "Category slug (e.g. 'jewelry', 'home-and-living', 'clothing', 'art-and-collectibles', 'craft-supplies-and-tools')",
      "required": true
    }
  ],
  "steps": [
    {
      "action": "navigate",
      "url": "https://www.etsy.com/c/{{category}}",
      "label": "Open category page"
    },
    {
      "action": "waitForSelector",
      "selector": ".v2-listing-card, a.listing-link, h1, li[data-listing-id]",
      "timeout": 15000,
      "label": "Wait for category page to load"
    },
    {
      "action": "wait",
      "ms": 2000,
      "label": "Let page render"
    },
    {
      "action": "scroll",
      "direction": "down",
      "amount": 1200,
      "label": "Scroll to load more content"
    },
    {
      "action": "wait",
      "ms": 1500
    },
    {
      "action": "scroll",
      "direction": "down",
      "amount": 1200,
      "label": "Scroll further down"
    },
    {
      "action": "wait",
      "ms": 1500
    },
    {
      "action": "code",
      "code": "const headingEl = document.querySelector('h1'); const subcategoryEls = document.querySelectorAll('a[href*=\"/c/\"]'); const subcategories = []; const seenUrls = {}; subcategoryEls.forEach(function(el) { const text = el.textContent.trim(); const href = el.getAttribute('href') || ''; const fullUrl = href.startsWith('http') ? href : 'https://www.etsy.com' + href; if (text && text.length < 100 && href.includes('/c/') && !seenUrls[fullUrl]) { seenUrls[fullUrl] = true; subcategories.push({ name: text, url: fullUrl }); } }); const listings = []; const listingEls = document.querySelectorAll('.v2-listing-card, li[data-listing-id]'); for (let i = 0; i < Math.min(listingEls.length, 20); i++) { const el = listingEls[i]; const titleEl = el.querySelector('h2.v2-listing-card__title, h3.v2-listing-card__title, h2, h3, a[title]'); const priceEl = el.querySelector('span.currency-value, [data-currency-value]'); const currencyEl = el.querySelector('span.currency-symbol'); const linkEl = el.querySelector('a.listing-link, a[href*=\"/listing/\"]'); const imgEl = el.querySelector('img'); const shopEl = el.querySelector('p a[href*=\"/shop/\"], [aria-label*=\"shop\"]'); const ratingEl = el.querySelector('[aria-label*=\"star\"], [aria-label*=\"rating\"]'); const freeShippingEl = el.querySelector('[aria-label*=\"shipping\"], [data-free-shipping]'); listings.push({ title: titleEl ? (titleEl.getAttribute('title') || titleEl.textContent.trim()) : '', price: (currencyEl ? currencyEl.textContent.trim() : '') + (priceEl ? priceEl.textContent.trim() : ''), url: linkEl ? linkEl.href : '', image: imgEl ? imgEl.getAttribute('src') : '', shop_name: shopEl ? shopEl.textContent.trim() : '', rating: ratingEl ? (ratingEl.getAttribute('aria-label') || ratingEl.textContent.trim()) : '', free_shipping: !!freeShippingEl }); } return { category: `{{category}}`, heading: headingEl ? headingEl.textContent.trim() : '', subcategory_count: subcategories.length, subcategories: subcategories.slice(0, 20), listing_count: listings.length, listings: listings, url: window.location.href }",
      "name": "category_data",
      "label": "Extract category content"
    }
  ]
}
