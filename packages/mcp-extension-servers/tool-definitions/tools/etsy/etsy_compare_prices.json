{
  "id": "etsy-compare-prices",
  "name": "etsy_compare_prices",
  "description": "Compare prices for similar items on Etsy. Searches for the given query and extracts pricing details from multiple listings including price, shipping cost, shop rating, and total cost for easy comparison.",
  "version": "1.0.0",
  "parameters": [
    {
      "name": "query",
      "type": "string",
      "description": "Product search query to compare prices for (e.g. 'sterling silver ring', 'custom phone case')",
      "required": true
    }
  ],
  "steps": [
    {
      "action": "navigate",
      "url": "https://www.etsy.com/search?q={{query}}&explicit=1&order=price_asc",
      "label": "Search Etsy sorted by price"
    },
    {
      "action": "waitForSelector",
      "selector": "[data-search-results] li, .search-listings-group li, .v2-listing-card, [class*='listing-card']",
      "timeout": 15000,
      "label": "Wait for search results"
    },
    {
      "action": "wait",
      "ms": 2000,
      "label": "Let results render"
    },
    {
      "action": "scroll",
      "direction": "down",
      "amount": 1200,
      "label": "Scroll to load more results"
    },
    {
      "action": "wait",
      "ms": 1500
    },
    {
      "action": "scroll",
      "direction": "down",
      "amount": 1200,
      "label": "Scroll further"
    },
    {
      "action": "wait",
      "ms": 1500
    },
    {
      "action": "code",
      "code": "const items = []; const listingEls = document.querySelectorAll('.v2-listing-card, [class*=\"listing-card\"][data-listing-id], [data-search-results] li .v2-listing-card, .search-listings-group .v2-listing-card'); const candidates = listingEls.length > 0 ? listingEls : document.querySelectorAll('[data-search-results] li, .search-listings-group li'); for (let i = 0; i < Math.min(candidates.length, 20); i++) { const el = candidates[i]; const titleEl = el.querySelector('h3, [class*=\"title\"], a[title]'); const priceEl = el.querySelector('[class*=\"price\"] .currency-value, .wt-text-title-01 .currency-value, span[class*=\"price\"]'); const currencyEl = el.querySelector('.currency-symbol'); const linkEl = el.querySelector('a[href*=\"/listing/\"]'); const shopEl = el.querySelector('[class*=\"shop-name\"], .v2-listing-card__shop a, p[class*=\"shop\"]'); const ratingEl = el.querySelector('[class*=\"rating\"] span, .wt-screen-reader-only'); const reviewCountEl = el.querySelector('[class*=\"review\"] span, [class*=\"rating\"] + span'); const freeShippingEl = el.querySelector('[class*=\"free-shipping\"], [class*=\"freeShipping\"]'); const shippingEl = el.querySelector('[class*=\"shipping-cost\"], [class*=\"shipping\"] span'); const originalPriceEl = el.querySelector('[class*=\"original-price\"], [class*=\"strikethrough\"], s, del'); const saleEl = el.querySelector('[class*=\"sale\"], [class*=\"discount\"], [class*=\"percent-off\"]'); const title = titleEl ? (titleEl.getAttribute('title') || titleEl.textContent.trim()) : ''; if (title) { items.push({ title: title.substring(0, 200), price: (currencyEl ? currencyEl.textContent.trim() : '') + (priceEl ? priceEl.textContent.trim() : ''), original_price: originalPriceEl ? originalPriceEl.textContent.trim() : '', discount: saleEl ? saleEl.textContent.trim() : '', shipping: freeShippingEl ? 'Free shipping' : (shippingEl ? shippingEl.textContent.trim() : ''), shop_name: shopEl ? shopEl.textContent.trim() : '', rating: ratingEl ? ratingEl.textContent.trim() : '', review_count: reviewCountEl ? reviewCountEl.textContent.trim() : '', url: linkEl ? linkEl.href : '' }); } } items.sort(function(a, b) { const priceA = parseFloat(a.price.replace(/[^0-9.]/g, '')) || 0; const priceB = parseFloat(b.price.replace(/[^0-9.]/g, '')) || 0; return priceA - priceB; }); const prices = items.map(function(item) { return parseFloat(item.price.replace(/[^0-9.]/g, '')) || 0; }).filter(function(p) { return p > 0; }); const avgPrice = prices.length > 0 ? (prices.reduce(function(a, b) { return a + b; }, 0) / prices.length).toFixed(2) : '0'; const minPrice = prices.length > 0 ? Math.min.apply(null, prices).toFixed(2) : '0'; const maxPrice = prices.length > 0 ? Math.max.apply(null, prices).toFixed(2) : '0'; return { query: `{{query}}`, item_count: items.length, price_summary: { average: avgPrice, lowest: minPrice, highest: maxPrice, currency: items.length > 0 ? items[0].price.replace(/[0-9.,\\s]/g, '').trim() : '' }, items: items }",
      "name": "comparison_data",
      "label": "Extract and compare prices"
    }
  ]
}